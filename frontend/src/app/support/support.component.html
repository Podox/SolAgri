<!-- Navbar HTML -->
<header class="sticky top-0 z-50 w-full border-b bg-white">
  <div class="container mx-auto px-4 md:px-6">
    <div class="flex h-16 items-center justify-between">
      <div class="flex items-center gap-2">
        <a routerLink="/" class="flex items-center">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
               fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
               stroke-linejoin="round" class="h-6 w-6 text-green-600 mr-2">
            <circle cx="12" cy="12" r="4"></circle>
            <path d="M12 2v2"></path>
            <path d="M12 20v2"></path>
            <path d="m4.93 4.93 1.41 1.41"></path>
            <path d="m17.66 17.66 1.41 1.41"></path>
            <path d="M2 12h2"></path>
            <path d="M20 12h2"></path>
            <path d="m6.34 17.66-1.41 1.41"></path>
            <path d="m19.07 4.93-1.41 1.41"></path>
          </svg>
          <span class="text-xl font-bold text-green-800">SolAgri</span>
        </a>
      </div>

      <nav class="hidden md:flex items-center gap-6">
        <a routerLink="/support"
           class="text-sm font-medium text-gray-700 hover:text-green-600 transition-colors">
          Support
        </a>
        <a routerLink="/"
           class="text-sm font-medium text-gray-700 hover:text-green-600 transition-colors">
          Home
        </a>
        <ng-container *ngIf="!loggedIn; else loggedInBlock">
          <a routerLink="/login"
             class="inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-9 px-4 py-2">
            Login
          </a>
          <a routerLink="/register"
             class="inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-green-600 hover:bg-green-700 text-white h-9 px-4 py-2">
            Register
          </a>
        </ng-container>

        <ng-template #loggedInBlock>
          <button (click)="logout()"
                  class="inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-red-600 hover:bg-red-700 text-white h-9 px-4 py-2">
            Logout
          </button>
        </ng-template>
      </nav>
    </div>
  </div>
</header>

<!-- Support Page Content -->
<div class="max-w-5xl mx-auto p-6">
  <h2 class="text-3xl font-bold text-green-800 mb-6">Support Tickets</h2>

  <!-- Ticket Form -->
  <form [formGroup]="form" (ngSubmit)="onSubmit()" class="space-y-4 bg-white p-6 rounded shadow-md border">
    <div>
      <label class="block text-sm font-medium text-gray-700 mb-1">Subject</label>
      <input
        class="w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-green-500"
        formControlName="subject"
        required />
    </div>

    <div>
      <label class="block text-sm font-medium text-gray-700 mb-1">Description</label>
      <textarea
        class="w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-green-500"
        rows="4"
        formControlName="description"
        required></textarea>
    </div>

    <button
      class="bg-green-600 text-white px-5 py-2 rounded hover:bg-green-700 transition disabled:opacity-50"
      [disabled]="form.invalid">
      Submit Ticket
    </button>
  </form>

  <!-- Error Message -->
  <div *ngIf="error" class="mt-4 text-red-600 bg-red-100 border border-red-300 px-4 py-2 rounded">
    {{ error }}
  </div>

  <!-- Tickets Table -->
  <div class="mt-10">
    <h4 class="text-xl font-semibold text-gray-800 mb-4">My Tickets</h4>

    <div *ngIf="tickets.length > 0" class="overflow-x-auto">
      <table class="min-w-full table-auto border-collapse border border-gray-200 rounded-lg overflow-hidden">
        <thead class="bg-gray-100 text-gray-700">
        <tr>
          <th class="px-4 py-2 text-left border-b border-gray-200">ID</th>
          <th class="px-4 py-2 text-left border-b border-gray-200">Subject</th>
          <th class="px-4 py-2 text-left border-b border-gray-200">Status</th>
          <th class="px-4 py-2 text-left border-b border-gray-200">Created</th>
          <th class="px-4 py-2 text-left border-b border-gray-200">Updated</th>
        </tr>
        </thead>
        <tbody>
        <tr *ngFor="let t of tickets" class="hover:bg-gray-50">
          <td class="px-4 py-2 border-b border-gray-200">{{ t.id }}</td>
          <td class="px-4 py-2 border-b border-gray-200">{{ t.subject }}</td>
          <td class="px-4 py-2 border-b border-gray-200">{{ t.status }}</td>
          <td class="px-4 py-2 border-b border-gray-200">{{ t.createdAt | date:'short' }}</td>
          <td class="px-4 py-2 border-b border-gray-200">{{ t.updatedAt | date:'short' }}</td>
        </tr>
        </tbody>
      </table>
    </div>

    <p *ngIf="tickets.length === 0" class="text-gray-600 mt-4">No support tickets yet.</p>
  </div>
</div>
