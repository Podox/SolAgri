<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Solar Prediction</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light p-5">

<div class="container">
    <h2 class="mb-4">Solar Panel Prediction for Agriculture</h2>

    <form id="predictionForm" class="bg-white p-4 rounded shadow-sm">
        <div class="mb-3">
            <label for="seed" class="form-label">Seed Type</label>
            <input type="text" id="seed" name="seed" class="form-control" required>
        </div>
        <div class="mb-3">
            <label for="landSurface" class="form-label">Land Surface (m²)</label>
            <input type="number" id="landSurface" name="landSurface" class="form-control" required>
        </div>
        <div class="mb-3">
            <label for="waterDepth" class="form-label">Water Depth (m)</label>
            <input type="number" id="waterDepth" name="waterDepth" class="form-control" required>
        </div>
        <div class="mb-3">
            <label for="waterTravelingDistance" class="form-label">Water Traveling Distance (m)</label>
            <input type="number" id="waterTravelingDistance" name="waterTravelingDistance" class="form-control" required>
        </div>
        <button type="submit" class="btn btn-primary">Predict</button>
    </form>

    <div id="resultContainer" class="mt-4" style="display: none;">
        <h4>Prediction Results:</h4>
        <ul class="list-group">
            <li class="list-group-item"><strong>Kilowatts:</strong> <span id="kilowatts"></span></li>
            <li class="list-group-item"><strong>Panels:</strong> <span id="panels"></span></li>
            <li class="list-group-item"><strong>Surface Area:</strong> <span id="surfaceArea"></span></li>
            <li class="list-group-item"><strong>Cost (MAD):</strong> <span id="cost"></span></li>
        </ul>
        <button class="btn btn-secondary mt-3" onclick="toggleExplanation()">Get Explanation</button>
        <p id="explanation" class="mt-3" style="display: none;"></p>
    </div>
</div>

<script>
    document.getElementById("predictionForm").addEventListener("submit", function (event) {
        event.preventDefault(); // ✅ Important!

        const inputData = {
            seed: document.getElementById("seed").value,
            landSurface: parseFloat(document.getElementById("landSurface").value),
            waterDepth: parseFloat(document.getElementById("waterDepth").value),
            waterTravelingDistance: parseFloat(document.getElementById("waterTravelingDistance").value)
        };

        fetch("/api/solar/predict", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(inputData)
        })
            .then(response => {
                if (!response.ok) throw new Error("Network response was not ok.");
                return response.json();
            })
            .then(data => {
                document.getElementById("kilowatts").textContent = data.kilowatts;
                document.getElementById("panels").textContent = data.panels;
                document.getElementById("surfaceArea").textContent = data.surfaceArea;
                document.getElementById("cost").textContent = data.cost;
                document.getElementById("explanation").textContent = data.explanation;
                document.getElementById("resultContainer").style.display = "block";
            })
            .catch(error => {
                console.error("❌ Error:", error);
                alert("Failed to get prediction. Check console for details.");
            });
    });

    function toggleExplanation() {
        const explanation = document.getElementById("explanation");
        explanation.style.display = explanation.style.display === "none" ? "block" : "none";
    }
</script>

</body>
</html>
